class Local2Json{#a={"==":(e,t)=>e==t,"===":(e,t)=>e===t,"<":(e,t)=>e<t,"<=":(e,t)=>e<=t,">":(e,t)=>e>t,">=":(e,t)=>e>=t,"!=":(e,t)=>e!=t,"%%":(e,t)=>t.includes(e),$gt:(e,t)=>e>t,$lt:(e,t)=>e<t,$in:(e,t)=>t.includes(e)};constructor(e){this.name=e,this.collections=new Set,this.triggers={},this.indexes=new Map,this.#b()}#b(){for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t.startsWith(`${this.name}_`)){let s=t.split("_")[1];this.collections.add(s)}}}Id(e=24){let t="abcdefghijklmnopqrstuvwxyz0123456789";return Array.from(crypto.getRandomValues(new Uint8Array(e))).map(e=>t[e%t.length]).join("")}#c(i){let n=this.GetCollection(i);localStorage.setItem(`${this.name}_${i}`,JSON.stringify(n,null,0))}CreateCollection(e,t={index:[]}){return!this.collections.has(e)&&(this.collections.add(e),this.#c(e),t.index.forEach(t=>this.#d(e,t)),!0)}#d(l,r){this.indexes.has(l)||this.indexes.set(l,new Map);let h=this.indexes.get(l);h.set(r,new Map),this.GetCollection(l).forEach(e=>{let t=e[r];void 0!==t&&(h.get(r).has(t)||h.get(r).set(t,new Set),h.get(r).get(t).add(e.ID))})}GetCollection(e){return JSON.parse(localStorage.getItem(`${this.name}_${e}`))||[]}Insert(e,t){if(!this.collections.has(e))return!1;let s=this.GetCollection(e);return t.ID=this.Id(),s.push(t),this.#e(e,t,"add"),localStorage.setItem(`${this.name}_${e}`,JSON.stringify(s,null,0)),this.#f(e,"insert"),t.ID}#e(o,a,c){if(!this.indexes.has(o))return;let d=this.indexes.get(o);d.forEach((e,t)=>{let s=a[t];void 0!==s&&("add"===c?(e.has(s)||e.set(s,new Set),e.get(s).add(a.ID)):e.has(s)&&e.get(s).delete(a.ID))})}Query(e,t={}){let s=this.GetCollection(e);return s.filter(e=>Object.entries(t).every(([t,s])=>"object"==typeof s?Object.entries(s).every(([s,i])=>this.#a[s](e[t],i)):e[t]===s))}GetById(e,t){return this.Query(e,{ID:t})[0]}Update(e,t,s){let i=this.Query(e,t),n=this.GetCollection(e);return i.forEach(t=>{Object.assign(t,s),this.#e(e,t,"update")}),localStorage.setItem(`${this.name}_${e}`,JSON.stringify(n,null,0)),this.#f(e,"update"),i.length}Delete(e,t){let s=this.GetCollection(e).filter(e=>!Object.entries(t).every(([t,s])=>"object"==typeof s?Object.entries(s).every(([s,i])=>this.#a[s](e[t],i)):e[t]===s));return localStorage.setItem(`${this.name}_${e}`,JSON.stringify(s,null,0)),this.#f(e,"delete"),this.GetCollection(e).length-s.length}#f(g,u){let f=`${g}_${u}`;this.triggers[f]&&this.triggers[f]()}Trigger(e,t,s){this.triggers[`${e}_${t}`]=s}Clear(){this.collections.forEach(e=>{localStorage.removeItem(`${this.name}_${e}`)}),this.collections.clear(),this.indexes.clear(),this.triggers={}}}